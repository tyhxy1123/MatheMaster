\section{Adaptive refinement / coarsening}
Assume $\T$ of $\Omega$, $u_h\in V_h$ is a FEM-solution \nl
a posteori error estimate 
\begin{equation*}
	\|u-u_h\| \leq \eta(u_h) = \left( \displaystyle \sum_{T\in \T} (\eta_T(u_h))^p\right)^{1/p}, \quad p\in [1,\infty)
\end{equation*}
$\eta$ is a computable funtion, only dependable on FEM-solution. If $\tol$ is a given tolerance and $\eta(u_h) > \tol$. Where to refine $\T$ in order to reduce the error?
\subsection{General strategy for elliptic problems}
start with $\T_0$ and $\tol$
\begin{align*}
	{}&k=0\\
	{}&\text{solve discrete problem on }\T_h \text{ compute global error estimate }\\
	{}& \eta \text{ and local error estimation} \eta_T \text{ for} T\in \T_k\\
	{}&while \eta > \tol do\\
	{}& \quad mark elements for retirement\\
	{}& \quad adapt mesh\\
	{}& \quad k=k+1\\
	{}& \quad solve discrete problem on \T_h\\
	{}& \quad compute \eta and \eta_T for T\in \T_k\\
	{}&end while	 
\end{align*}
strategy: local error is similiar for all elements $\implies$ elements with large local error can be coarsed
\begin{enumerate}[label=\alph*)]
	\item global refinement
	\item maximum strategy, $\gamma \in(0,1)$ refine all elements with 
	\begin{equation*}
		\eta_T > \gamma \underset{T'\in\T_K}{\max} \eta_{T'}
	\end{equation*}
	typical $\gamma=\frac{1}{2}$ 
	\item equidistribution strategy\\
	$N_K$ number of elements in $\T_K$, assuming equal distribution of the error, e.g.
	\begin{align*}
		\eta_T &= \eta_{T'} \quad \forall T,T' \in \T_K\\
		\eta &= \left(\displaystyle \sum_{T \in \T_K} (\eta_T)^p \right)^{\frac{1}{p}} = (N_K)^{\frac{1}{p}} \eta_T \overset{!}{=} \tol
	\end{align*}
	\begin{equation*}
		\eta_T = \frac{\tol}{(N_K)^\frac{1}{p}}
	\end{equation*}
	choose $\Theta \in (0,1)$, $\Theta \approx1 $, refine all elements with 
	\begin{equation*}
		\eta_T > \Theta \frac{\tol}{(N_K)^\frac{1}{p}}
	\end{equation*}
	
	\item guaranteed error reduction\\
	usually it is not clear, that the error is reduced and the strategy converges\\
	idea: refine a subset of triangulation, whose element errors sum up to a fixed amount of $\eta$
\end{enumerate}

\subsection{Coarsening}
refinement is sufficient for linear elliptic problems, but for time dependent problems coarsening is needed too.
\begin{itemize}
	\item for maximum strategy: $\gamma > \gamma_C$: coarsen all elements with
	\begin{equation*}
		\eta_T^p + \underbrace{\eta_{C,T}^p}_{\text{loss through coarsening}} \leq \gamma_C \underset{T'\in\T_K}{\max} \eta_{T'}
	\end{equation*}
	\item for equidistribution strategy $\Theta_C \in(0,1)$ coarsen all elements with 
	\begin{equation*}
		\eta_T + \eta_{C,T} \leq \Theta_C \frac{\tol}{(N_K)^\frac{1}{p}}
	\end{equation*}
\end{itemize}

\underline{time-dependent problems}:\nl
\begin{itemize}
	\item explicit strategy: do iteration only once $\to$ next timestep
	\item semi-implicit: do a adaption only once
	\item implicit strategy: adapt until $\tol$ is reached in each timestep
	\begin{itemize}
		\item start with coarse mesh
		\item start with the mesh from the previous time step
	\end{itemize}
\end{itemize}
How to compute $\eta_T$?\vspace{1cm}
\begin{example}
	Compute drag coefficient in an incompressible flow around a cylinder(fine mesh needed at green parts)\\
	%TODO add pic 
	Navier-Stokes equation
	\begin{align*}
	\begin{cases}
	\partial_t v - \nu \laplace v + v \cdot \nabla v + \nabla p = f\\
	\hspace{3.4cm}\nabla \cdot v = 0
	\end{cases}
	\end{align*}
	with unknowns: velocity $v$ and pressure $p$.\\
	drag coefficient 
	%TODO is that right?
	\begin{equation*}
		\exists (v,p) = \frac{2}{\bar{u}^2D}\int \limits_S n^T \left(2v \tau -p I\right) \partial \partial S
	\end{equation*}
	\begin{align*}
		&S && \text{surface of cylinder}\\
		&D && \text{diameter of cylinder}\\
		&\bar{u} && \text{maximum inflow velocity}\\
		&\tau \approx \frac{1}{2}(\nabla v + (\nabla v )^T) && \text{stress tensor}\\
		&n && \text{normal}\\
		&d=(0,1)^T && \text{flow direction}\\
	\end{align*}
	%TODO ist die Aufteilung richtig hier?
	\begin{itemize}
		\item heuristic indicator: $\eta_T$
		\item verticity: $\eta_T = h_T \|\nabla \times v_h\|_T$
		\item first order pressure gradient:  $\eta_T = h_T \|\nabla p_h\|_T$
		\item second order velocity gradient:  $\eta_T = h_T \|\nabla^2 v_h\|_T$
		\item residual based indicator: 
		\begin{equation*}
			\eta_T = h_T \|R_h\|_T +  h_T^{(1/2)} \|r_h\|_T + h_T \|\nabla v_h\|_T
		\end{equation*}
		with 
		\begin{align*}
			R_h &= f + \nu \laplace v_h - v_h \cdot \nabla v_h -  \nabla p \\
			r_h &= 
			\begin{cases}
				\frac{1}{2}(\nu ?? v_h - n p_h), &\text{for }\Gamma \nsubseteq \partial \Omega\\
				0 ,&\text{for }\Gamma \subset \Gamma_{\text{rigid}}\cup\Gamma_{\text{in}}\\
				-\nu ?? v_h + n p_h, &\text{for }\Gamma \subset \Gamma_{\text{out}}
			\end{cases} 
		\end{align*}
	\end{itemize}
	comment on residuals(lin. alg.)\nl
	\begin{align*}
		Ax&=b &  A_h x_h &= b_h &&A,A_h \in \R^{n\times n},x,x_h,b,b_h\in\R^n \\
		A_h&\to A & b_h &\to b  &&(h\to 0)\\
	\end{align*}
	\begin{align*}
		e&= x-x_h &&\text{error}\\
		\rho&= b-Ax_h&&\text{residual}
	\end{align*}
	%TODO ist die strukturierung richtig?
\end{example}
\subsection{a posteriori error analysis uses}
\begin{equation*}
	Ae = Ax-Ax_h = b - Ax_h = \rho
\end{equation*}
$\implies \|e\| \leq c_T \|\rho\|$, with $c_T = \|A^{-1}\|$
\begin{align*}
	-\laplace u &= f \tin \Omega \\
	u &= 0 \ton \partial \Omega
\end{align*}
\begin{align*}
	\laplace u_h +f &= R_T= R_T(u_h) \quad (\text{volume residual on T}) \\
	\left[\frac{\partial u_h}{\partial n}\right] &= R_e= R_e(u_h) \quad (\text{edge residual on e}) \\
\end{align*}
$\implies$ residual error estimate(local)
\begin{align*}
	\eta_T = \left( h_T^2 \|R_T\|^2  + \frac{1}{2}\displaystyle \sum_{e\in \partial T}  h_e \|R_e\|^2\right)^{1/2}
\end{align*}
$\implies$ 
\begin{align*}
	\|u-u_h\|_1 \leq c \left( \sum \limits_{T \in \T} \eta_T^2 \right)^{1/2}
\end{align*}
residual error estimate(global)
\begin{equation*}
	\eta = \left(  \sum \limits_{T \in \T_K} \|R_T\|^2  +  \sum \limits_{e \in \Gamma_K} \|R_e\|^2 \right)^{1/2}
\end{equation*}
\begin{proof_}
	(of Lemma of Cea (where is (1)??))\\
	\begin{align*}
		a(u,v) &= \langle l,v\rangle\quad \forall v\in V \\
		a(u_h,v) &=\langle l,v\rangle \quad \forall v\in V_h \\
		\implies a(u-u_h,v) &=0 \quad \forall v\in V_h \\
	\end{align*}
	\begin{align}
		\implies ( \nabla(u-u_h),\nabla v_h )  =0 \quad \forall u \in V_h 
	\end{align} 
	Let's consider $w \in V$:
	\begin{align*}
		\langle l,w\rangle &= (\nabla(u-u_h),\nabla w) = (f,w) - \sum\limits_T (\nabla u_h,\nabla w)\\
		&\stackeq{\text{Int.by parts}} (f,w) - 
	\end{align*}
\end{proof}