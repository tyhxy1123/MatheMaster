\chapter{Approximation by piecewise polynomials}
\begin{equation*}
	S^n(\T):= \left\{ v \in C(\Omega): v|_{T} \text{ is a polynomial of degree} \leq n \ \forall\, T \in \T \right\}
\end{equation*}
\begin{theorem}
	% TODO maybe change I to \I or somethin
	Let $I^n\colon C(\Omega) \to S^n(\T)$ be the Lagrange interpolation.
	Let $h$ be the largest element size in $\T$.
	Then there is a constant $c$ such that
	\begin{equation*}
		\|D(u-I^nu)\|_{L^{2}} \leq c\; h^n\; \|D^{n+1}u\|_{L^{2}}
	\end{equation*}
	for all $u \in H^{n+1}(\Omega)$.
\end{theorem}
Note that, even for  $n=1$, the theorem requires $v \in H^2$.
That is not always the case (for example the simpliest existence
theorem only imply that a solution exists in $H^1$.)
Secondly $|u|_{H^1}$ might be very big.
\begin{theorem}[Sobolev inequality]\enter
	Let $\Omega$ be a $d$-dimensional domain with a Lipschitz boundary.
	Let $k \in \N$, $p \in \R$ with $1 < p < \infty$ such that
	\begin{equation*}
		k-\frac{d}{p}>0
	\end{equation*}
	then the equivalence class of each $u \in W^{k,p}(\Omega)$ has a continuous representative.
\end{theorem}
\underline{Consequence}: The Lagrange interpolation of $H^1$ functions is only possible in $1d$ domains since $1 - \frac {d}{2} > 0$ implies $d < 2$ since Lagrange interpolation needs point values.
\begin{definition}
  The \underline{Sobolev number} of $W^{k,p}(\Omega)$ is
	\begin{equation*}
		\sob(W^{k,p}):= k - \frac{d}{p}
	\end{equation*}
\end{definition}
Why $k-\frac{d}{p}$?
\begin{itemize}
	\item Let $v \in W^{k,p}(\Omega)$.
	\item Let $h > 0$, introduce the new variables $\hat{x}= \frac{x}{h}$ .
	\item This variable transformation transform $\Omega \to \hat{\Omega}$, and $v$ to $\hat{v}$ in $\hat{\Omega}$.
  \item Then (exercise):
    \begin{equation*}
      |\hat{v}|_{W^{k,p}(\hat{\Omega})} = h^{k-\frac{d}{p}} |v|_{W^{k,p}(\Omega)}
    \end{equation*}
\end{itemize}
\begin{definition}
	The discrete neighborhood of $T$ is
	\begin{equation*}
		N(T):= \left\{ T' \in \T : T'\cap T \neq \emptyset \right\}
	\end{equation*}
\end{definition}
\begin{theorem}[Local quasi-interpolation error]\enter
	Let $s$ be a regularity index with $0 \leq s \leq n+1$.
	Let $p$ be the integrability index ($1 \leq p \leq \infty$).
	Then there exists an operator $I_{\T}\colon L^1(\Omega) \to S^n(\T)$ such that for all $T \in \T$
	\begin{equation*}
    \|D^t(v - I_{\T}v)\|_{L^{q}(T)} \leqC h_{T}^{\sob(W^{s,p})-\sob(W^{t,q})} \|D^s v\|_{L^{p}(N(T))}
	\end{equation*}
	where $0 \leq t \leq s$, $1 \leq q\leq \infty$ and $\sob(W^{s,p}) > \sob(W^{t,q})$.
	The constant depends on $d$ and the shape coefficients of $\T$.
\end{theorem}
Here we use the symbol $\leqC$ for \enquote{less up to a constant} and
will do so for the remaining course.
\begin{proof}\
	\begin{itemize}
		\item Let $\left\{ \phi_{z} \right\}_{z \in \mathcal{L}(\T)}$ be the Lagrange basis of $S^n(\T)$.
			($\mathcal{L}$ is the set of all Lagrange points)
			Exercise: There is a dual basis $\left\{ \phi^*_{z} \right\}_{z \in \mathcal{L}(\T)}$ to $\left\{ \phi_{z} \right\}$, i.e.
			\begin{equation*}
				\int_{\Omega} \phi_{z} \phi^*_{y} \diff x = \begin{cases}
					1, \text{ if } y=z\\
					0\ \text{ else}
				\end{cases}
			\end{equation*}
			The $\phi_{y}^*$ are piecewise polynomials but not continuous. We have
			$\supp \phi_{z}^* = \supp \phi_{z}$ for all $z \in \mathcal{L}(\T)$.
		\item Define the quasi-interpolation operator $I$ by
			\begin{align*}
				Iv &= \sum\limits_{z \in \mathcal{L}}^{} \langle v,\phi_{z}^* \rangle \phi_{z}\\
           &= \sum\limits_{z \in \mathcal{L}(\T)} \left(\int\limits_{\supp \phi_{z}^*} v\phi_{z}^* \diff x\right)\phi_{z}
			\end{align*}
		\item $I$ really is a projection.

			Let $P= \sum\limits_{y}^{} \alpha_{y} \phi_{y} \in S^n$. Then
			\begin{align*}
				IP &= \sum\limits_{z}^{} \langle P,\phi_{z}^* \rangle \phi_{z} \\
				   &= \sum\limits_{z}^{} \Big\langle \sum\limits_{y}^{} \alpha_{y} \phi_{y},\phi_{z}^*\Big \rangle \phi_{z}\\
				   &= \sum\limits_{z,y}^{}\alpha_{y} \langle \phi_{y},\phi_{z}^* \rangle \phi_{z}\\
				   &= \sum\limits_{y}^{} \alpha_{y} \phi_{y}\\
				   &= P
			\end{align*}
			The averaging process that determines the values of $Iv$ on a simplex $T$ uses only values of $v$ from $N(T)$.
			In particular
			\begin{equation*}
        (I P)|_{T} = P \quad \text{for all } P \in \P_n(N(T))
			\end{equation*}
			\begin{equation*}
        \implies (v - Iv)|_{T} = (v-P - I(v-P))|_{T} \quad \forall\, T \in\T \text{ and } P \in \P_{n}
			\end{equation*}
			Let $\hat{T}$ be the reference simplex and let $F(\hat{x}):= B\hat{x} + x_{0}$ be an affine bijective map from $\hat{T}$ to $T$.
			Then for all $v \in W^{t,q}(T)$
			\begin{align*}
				\|D^tv\|_{L^{q}(T)} &\leqC \|B^{-1} \|^{t} |\det B|^{-\frac{1}{q}} \|D^t \hat{v}\|_{L^{q}(\hat{T})}\\
                            &\leqC h^{-(t-\frac{d}{p})} \|D^t \hat{v}\|_{L^{q}(\hat {T})}
			\end{align*}
		\item The space $\P_{n}(\hat{T})$ is finite-dimensional $\implies$ all norms are equivalent. In particular
			\begin{equation*}
				\forall Q \in \P_{n}(\hat{T}) \quad \|D^t Q\|_{L^{q}(\hat{T})} \leq \|Q\|_{W^{t,q}(\hat{T})} \leq\approx \|Q\|_{L^{q}\hat{T}}.
			\end{equation*}
			We want to apply this to
			\begin{align*}
				\|D^t(v-Iv)\|_{L^{q}(\hat{T})} &\leq \|D^t(v-P)\|_{L^{q}(\hat{T})} + \|D^tI(v-P)\|_{L^{q}(\hat{T})}\\
											   &\leq\approx \|D^t(v-P)\|_{L^{q}(\hat{T})} \|I(v-P)\|_{L^{q}(\hat{T})}
			\end{align*}
		\begin{lemma}
			For all $w\in L^q$ we have
			\begin{equation*}
				\|Iw\|_{L^{q}(\hat{T})} \leq \approx \|w\|_{L^{q}(N(\hat{T}))}
			\end{equation*}
		\end{lemma}
		\begin{proof}
			\begin{align*}
				\|Iw\|_{L^{q}(\hat{T})} &= \left\|\sum\limits_{z \in\mathcal{L}(\hat{T})}^{} <w,\hat{\phi}_{z}^*>\hat{\phi}_{z}\right\|_{L^{q}(\hat{T})}\\
										&\leq \sum\limits_{z \in\mathcal{L}(\hat{T})}^{} |<w,\hat{\phi}_{z}^*>| \underbrace{\|\hat{\phi}_{z}\|_{L^{q}(\hat{T})}}_{\text{indep. of} \T,h,w,\text{else}}\\
										&\leq\approx \sum\limits_{z \in\mathcal{L}(\hat{T})}^{} |<w,\hat{\phi}_{z}^*>|\\
										&= \sum\limits_{z \in\mathcal{L}(\hat{T})}^{} |\int\limits_{\hat{\Omega}}w\cdot\hat{\phi}_{z}^*\diff x |\\
										&\leq \sum\limits_{z \in\mathcal{L}(\hat{T})}^{} \  \int\limits_{\supp(\hat{\phi}_{z}^*)} |w \cdot \hat{\phi}_{z}^*|\diff x \\
										&\overset{\text{HÃ¶lder}}{\leq} \sum\limits_{z \in\mathcal{L}(\hat{T})}^{} \ |w|_{L^q(\supp(\hat{\phi}_{z}^*))} |\hat{\phi}_{z}^*|_{L^{q^*}(\supp(\hat{\phi}_{z}^*))}\\
										&\leq\approx \sum\limits_{z \in\mathcal{L}(\hat{T})}^{} \ |w|_{L^q(\supp(\hat{\phi}_{z}^*))} \\
										&\leq \sum\limits_{z \in\mathcal{L}(\hat{T})}^{} \ |w|_{L^q(N(\hat{T}))} \\
										&\leq\approx |w|_{L^q(N(\hat{T}))}
			\end{align*}
		\end{proof}
	\end{itemize}
	Back to the main proof:
	\begin{align*}
		\|D^t(v-Iv)\|_{L^{q}(\hat{T})} &\leq \|D^t(v-P)\|_{L^{q}(\hat{T})} + \|D^t(v-P)\|_{L^{q}(N(\hat{T}))}\\
									   &\leq \|v-P\|_{W^{t,q}(N(\hat{T}))}\\
									   &\leq\approx \|v-P\|_{W^{s,p}(N(\hat{T}))}
	\end{align*}
	Holds for all $P \in \P_{n}$ !( Rellich-Kondrachov theorem holds because\\ $\sob(W^{s,p})>\sob(W^{t,q})$)\\
	$\implies$
	\begin{align*}
		\|D^t(v-Iv)\|_{L^{q}(\hat{T})} &\leq\approx \inf_{p \in \P_{n}(N(\hat{T}))} \|v\|_{W^{s,p}} \\
									   &\leq\approx \|v\|_{W^{t,p}(N(\hat{T}))}
	\end{align*}
	Transform back onto $T$.
\end{proof}


